<!DOCTYPE html>
<html lang="en">

<head>
	<title>BookStrap E-Bookstore</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="format-detection" content="telephone=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="author" content="">
	<meta name="keywords" content="">
	<meta name="description" content="">

	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">

	<link rel="stylesheet" type="text/css" href="styles/css/normalize.css">
	<link rel="stylesheet" type="text/css" href="styles/icomoon/icomoon.css">
	<link rel="stylesheet" type="text/css" href="styles/css/vendor.css">
	<link rel="stylesheet" type="text/css" href="styles/bookstore_style.css">

</head>

<body data-bs-spy="scroll" data-bs-target="#header" tabindex="0">

	<header id="header">
		<div class="container-fluid">
			<div class="row align-items-center">
				<div class="col-md-2">
					<div class="main-logo">		
						<a href="index.html"><img src="images/bookstrap-logo.png" alt="logo"></a>
					</div>

				</div>
				<div class="col-sm-2">
					<a id="userName"></a>
				</div>
				<div class="col-md-8">

					<nav id="navbar">
						<div class="main-menu stellarnav">
							<ul class="menu-list">	
								<li class="menu-item active"><a href="#home">Home</a></li>
								<li class="menu-item"><a href="#featured-books" class="nav-link">Featured</a></li>
								<li class="menu-item" id="userInfo">
									<!-- Link to Account Page -->
									<a href="account.html" class="user-account for-buy">
										<i class="icon icon-user"></i><span>Account</span>
									</a>
								</li>
								<li class="menu-item">
									<!-- Link to Cart Page -->
									<a href="cart.html" class="cart for-buy">
										<i class="icon icon-clipboard"></i><span>Cart: ($0)</span>
									</a>
								</li>
								<li class="menu-item">
									<a href="https://github.com/raysonoon/ebookstore_project"><i class="icon icon-github"></i>
								</li>
							</ul>

							<div class="hamburger">
								<span class="bar"></span>
								<span class="bar"></span>
								<span class="bar"></span>
							</div>

						</div>
					</nav>

				</div>

			</div>
		</div>
	</header>


	<section id="billboard">

		<div class="container">
			<div class="row">
				<div class="col-md-12">



					<div class="main-slider pattern-overlay">
						<!--<div class="slider-item">-->

						<!-- Books will be dynamically inserted here -->

						<!--</div> slider-item-->
					</div><!--slider-->


				</div>
			</div>
		</div>

	</section>

	<section id="client-holder" data-aos="fade-up">
		<div class="container">
			<div class="row">
				<div class="inner-content">
					<div class="logo-wrap">
						<div class="grid">
							<a href="#"><img src="images/client-image1.png" alt="client"></a>
							<a href="#"><img src="images/client-image2.png" alt="client"></a>
							<a href="#"><img src="images/client-image3.png" alt="client"></a>
							<a href="#"><img src="images/client-image4.png" alt="client"></a>
							<a href="#"><img src="images/client-image5.png" alt="client"></a>
						</div>
					</div><!--image-holder-->
				</div>
			</div>
		</div>
	</section>

	<section id="featured-books" class="py-5 my-5">
		<div class="container">
			<div class="row">
				<div class="col-md-12">

					<div class="section-header align-center">
						<div class="title">
							<span>Some quality items</span>
						</div>
						<h2 class="section-title">Featured Books</h2>
					</div>

					<div class="product-list" data-aos="fade-up">
						<div class="row">

							<!-- Books will be dynamically inserted here -->


						</div><!--ft-books-slider-->
					</div><!--grid-->


				</div><!--inner-content-->
			</div>
		</div>
	</section>

	<section id="quotation" class="align-center pb-5 mb-5">
		<div class="inner-content">
			<h2 class="section-title divider">Quote of the day</h2>
			<blockquote data-aos="fade-up">
				<q>“The more that you read, the more things you will know. The more that you learn, the more places
					you’ll go.”</q>
				<div class="author-name">Dr. Seuss</div>
			</blockquote>
		</div>
	</section>

	<footer id="footer">
		<div class="container">
			<div class="row">

				<div class="col-md-4">

					<div class="footer-item">
						<div class="company-brand">
							<img src="images/bookstrap-logo.png" alt="logo" class="footer-logo">
							<p>By Rayson Oon and Soo Shan Yong</p>
						</div>
					</div>

				</div>

				<div class="col-md-2">

					<div class="footer-menu">
						<h5>Discover</h5>
						<ul class="menu-list">
							<li class="menu-item">
								<a href="index.html">Home</a>
							</li>
							<li class="menu-item">
								<a href="#featured-books">Books</a>
							</li>
							<li class="menu-item">
								<a href="account.html">Account</a>
							</li>
							<li class="menu-item">
								<a href="cart.html">View Cart</a>
							</li>
						</ul>
					</div>

				</div>
			</div>
					</div>
			<!-- / row -->

		</div>
	</footer>

	<div id="footer-bottom">
		<div class="container">
			<div class="row">
				<div class="col-md-12">

					<div class="copyright">
						<div class="row">

							<div class="col-md-6">
								<p>© 2022 All rights reserved. Free HTML Template by <a
										href="https://www.templatesjungle.com/" target="_blank">TemplatesJungle</a></p>
							</div>

							<div class="col-md-6">
								<div class="social-links align-right">
									<ul>
										<li>
											<a href="#"><i class="icon icon-github"></i></a>
										</li>
									</ul>
								</div>
							</div>

						</div>
					</div><!--grid-->

				</div><!--footer-bottom-content-->
			</div>
		</div>
	</div>

	<!-- Bootstrap Modal -->
	<div class="modal fade" id="bookModal" tabindex="-1" aria-labelledby="bookModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="bookModalLabel"></h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<img id="modal-image" src="" alt="" class="img-fluid mb-3">
					<p id="modal-title"></p>
					<p id="modal-author"></p>
					<p id="modal-price"></p>
					<p id="modal-description"></p>
					<p id="modal-quantity"></p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-primary" id="addToCartBtn" data-book_id="${book.book_id}">Add
						to Cart</button>
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>

	<script src="js/jquery-1.11.0.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
		crossorigin="anonymous"></script>
	<script src="js/plugins.js"></script>
	<script src="js/script.js"></script>

	<script>
		let currentBookId = null;  // Track the current book ID globally

		// Function to handle adding a book to the cart
		async function addToCart(book_id) {
			try {
				const response = await fetch('/ebookstore_project/cart', {
					method: 'POST',
					headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
					body: `book_id=${book_id}` // Send book_id as form data
				});

				const responseText = await response.text();
				console.log("Raw response:", responseText);

				if (responseText.includes("success")) {
					alert('Book added to cart successfully!');
				} else {
					alert('Failed to add book to cart. Please try again.');
				}
			} catch (error) {
				console.error('Error adding book to cart:', error);
				alert('Error adding book to cart. Please try again.');
			}
		}

		// Event listener for the "Add to Cart" button
		document.getElementById('addToCartBtn').addEventListener('click', function () {
			if (currentBookId) {
				addToCart(currentBookId); // Use the global book_id
			} else {
				console.error("Invalid book_id:", currentBookId);
			}
		});

		// Function to load book details into the modal
		async function loadBooks() {
			try {
				const response = await fetch('/ebookstore_project/query');  // Fetch book data from QueryServlet
				const books = await response.json();

				const bookContainer = document.querySelector('.product-list .row');
				bookContainer.innerHTML = ""; // Clear old content

				books.forEach(book => {
					const bookHTML = `
						<div class="col-md-3">
							<div class="featured-books product-item"
								data-title="${book.title}"
								data-author="${book.author}"
								data-price="$${book.price.toFixed(2)}"
								data-image="${book.image}"
								data-quantity="${book.quantity}"
								data-description="${book.description}"
								data-book_id="${book.book_id}">
								<figure class="product-style">
									<img src="${book.image}" alt="${book.title}" class="product-item">
									<button type="button" class="read-more"
											data-bs-toggle="modal" data-bs-target="#bookModal" 
											data-title="${book.title}"
											data-author="${book.author}"
											data-price="${book.price.toFixed(2)}"
											data-image="${book.image}"
											data-quantity="${book.quantity}"
											data-description="${book.description}"
											data-book_id="${book.book_id}">Read More</button>
								</figure>
								<figcaption>
									<h3>${book.title}</h3>
									<span>${book.author}</span>
									<div class="item-price">$${book.price.toFixed(2)}</div>
									<span>Stock: ${book.quantity}</span>
								</figcaption>
							</div>
						</div>
					`;
					bookContainer.innerHTML += bookHTML;
				});

				// Attach the modal data when the 'Read More' button is clicked
				const modal = document.getElementById('bookModal');
				modal.addEventListener('show.bs.modal', function (event) {
					const button = event.relatedTarget; // Button that triggered the modal
					const book_id = button.getAttribute('data-book_id');
					const title = button.getAttribute('data-title');
					const author = button.getAttribute('data-author');
					const price = button.getAttribute('data-price');
					const image = button.getAttribute('data-image');
					const description = button.getAttribute('data-description');
					const quantity = button.getAttribute('data-quantity');

					// Store the current book ID globally
					currentBookId = book_id;

					// Populate the modal with book data
					document.getElementById('bookModalLabel').textContent = title; // Set the modal title
					document.getElementById('modal-title').textContent = `Book Title: ${title}`;
					document.getElementById('modal-author').textContent = `Author: ${author}`;
					document.getElementById('modal-price').textContent = `Price: $${price}`;
					document.getElementById('modal-description').textContent = `Description: ${description}`;
					document.getElementById('modal-quantity').textContent = `Quantity left: ${quantity}`;
					document.getElementById('modal-image').setAttribute('src', image); // Set the image source

					// Get the "Add to Cart" button
					const addToCartBtn = document.getElementById('addToCartBtn');

					// Disable the "Add to Cart" button if quantity is 0, otherwise enable it
					if (quantity == 0) {
						addToCartBtn.disabled = true;
						addToCartBtn.textContent = 'Out of Stock';
					} else {
						addToCartBtn.disabled = false;
						addToCartBtn.textContent = 'Add to Cart';
					}

				});
			} catch (error) {
				console.error("Error loading books:", error);
			}
		}

		// Call loadBooks when the page is fully loaded
		jQuery(document).ready(function () {
			loadBooks();
		});


		// Function to load book details into the modal
		async function loadBillboardBooks() {
			try {
				const response = await fetch('/ebookstore_project/query');  // Fetch book data from QueryServlet
				const books = await response.json();

				const bookContainer = document.querySelector('.main-slider');
				bookContainer.innerHTML = ""; // Clear old content

				books.forEach(book => {
					const bookHTML = `
						<div class="slider-item">

							<div class="banner-content product-item" 
								data-title="${book.title}"
								data-author="${book.author}"
								data-price="$${book.price.toFixed(2)}"
								data-image="${book.image}"
								data-quantity="${book.quantity}"
								data-description="${book.description}">
									<h2 class="banner-title">${book.title}</h2>
									<p>${book.description}</p>
									<div class="btn-wrap" data-bs-toggle="modal" data-bs-target="#bookModal">
										<a href="#" class="btn btn-outline-accent btn-accent-arrow" data-bs-toggle="modal" data-bs-target="#bookModal" 
											data-title="${book.title}"
											data-author="${book.author}"
											data-price="${book.price.toFixed(2)}"
											data-image="${book.image}"
											data-quantity="${book.quantity}"
											data-description="${book.description}"
											data-book_id="${book.book_id}">Read More<i
													class="icon icon-ns-arrow-right"></i></a>
									</div>
							</div><!--banner-content-->
							<img src="${book.image}" alt="banner" class="banner-image" style="width: 100%; max-width: 400px; height: 600px; object-fit: cover; border-radius: 10px;">

						</div><!--slider-item-->
					`;
					bookContainer.innerHTML += bookHTML;
				});

				// 🔹 Reinitialize Slick.js after dynamically adding books
				setTimeout(() => {
					$(".main-slider").slick('unslick'); // Destroy existing instance if needed
					$(".main-slider").slick({
						arrows: true,
						dots: true,
						infinite: true,
						slidesToShow: 1,
						slidesToScroll: 1
					});
				}, 300); // Small delay to ensure elements are loaded

				// Attach the modal data when the 'Read More' button is clicked
				const modal = document.getElementById('bookModal');
				modal.addEventListener('show.bs.modal', function (event) {
					const button = event.relatedTarget; // Button that triggered the modal
					const book_id = button.getAttribute('data-book_id');
					const title = button.getAttribute('data-title');
					const author = button.getAttribute('data-author');
					const price = button.getAttribute('data-price');
					const image = button.getAttribute('data-image');
					const description = button.getAttribute('data-description');
					const quantity = button.getAttribute('data-quantity');

					// Store the current book ID globally
					currentBookId = book_id;

					// Populate the modal with book data
					document.getElementById('bookModalLabel').textContent = title; // Set the modal title
					document.getElementById('modal-author').textContent = `Author: ${author}`;
					document.getElementById('modal-title').textContent = `Book Title: ${title}`;
					document.getElementById('modal-price').textContent = `Price: $${price}`;
					document.getElementById('modal-description').textContent = `Description: ${description}`;
					document.getElementById('modal-quantity').textContent = `Quantity left: ${quantity}`;
					document.getElementById('modal-image').setAttribute('src', image); // Set the image source

					// Get the "Add to Cart" button
					const addToCartBtn = document.getElementById('addToCartBtn');

					// Disable the "Add to Cart" button if quantity is 0, otherwise enable it
					if (quantity == 0) {
						addToCartBtn.disabled = true;
						addToCartBtn.textContent = 'Out of Stock';
					} else {
						addToCartBtn.disabled = false;
						addToCartBtn.textContent = 'Add to Cart';
					}

				});
			} catch (error) {
				console.error("Error loading books:", error);
			}
		}

		// Call loadBillboardBooks when the page is fully loaded
		jQuery(document).ready(function () {
			loadBillboardBooks();
		});

	</script>



	<script>
		async function displayUserData() {

			// Fetch user data from GetSessionDataServlet
			const response = await fetch('/ebookstore_project/getSessionData');
			const data = await response.json();

			if (data.userEmail && data.userName && data.userId) {
				// Store user data in sessionStorage
				sessionStorage.setItem('userEmail', data.userEmail);
				sessionStorage.setItem('userName', data.userName);
				sessionStorage.setItem('userId', data.userId);
				sessionStorage.setItem('phone_number', data.phone_number);
				sessionStorage.setItem('wallet_balance', data.wallet_balance);

				// Display user data in the HTML
				//document.getElementById("userEmail").innerText = "Email: " + data.userEmail;
				document.getElementById("userName").innerText = "Welcome " + data.userName + "!";
				//document.getElementById("userId").innerText = "User ID: " + data.userId;
			} else {
				document.getElementById("userInfo").innerText = "No user data found.";
			}
		}

		// Call this function to display the user data when the page loads
		window.onload = displayUserData;

	</script>



</body>

</html>